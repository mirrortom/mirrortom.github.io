<!DOCTYPE html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1.0,user-scalable=no"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content=#da532c><meta name=theme-color content=#ffffff><title>分离轴理论 | Mirror Space</title><link href=/mirrorui/mirrorui.css rel=stylesheet><link href=/asset/css/blog.css rel=stylesheet><div class=layout><div class=layout-part1></div><div class=layout-part2><div class=wz-page><h2>分离轴定理 Separating Axis Theorem</h2><p>分离轴定理用于判断两个凸多边形是否碰撞.原理的理解如下:<p>有两个凸多边形,在一个方向上,用一束光照射,得到两个凸多边形的投影.如果投影有间隙,说明这两个凸多边形没有碰撞.如果没有间隙,可能<p>是碰撞的.再换一个方向,用光照射,如果还没有间隙,则可能是碰撞的.再换方向...如此反复,直到所有方向照射的投影都没有间隙,则是碰撞的.<p>只要在一个方向上有间隙,就能说明没有碰撞.<p>只能用于凸多边形,即内角小于180度的多边形.例如正五边形.五角星不是凸多边形,不适用此法.<p>凸多边形有个判断方法,如果连接所有定点的线段都在多边形内,则是凸多边形,否则不是.</p><canvas id=canvas10></canvas><h3>投影</h3><p>从一个方向,光束照射在凸多边形上,得到的投影.下图假设从上往下,从左往右,两个方向照射,得到的投影用多边形的颜色区分.<p>观看投影,发现两个方向的投影都有重叠.可是事实上,这两个物体并没有碰撞.</p><canvas id=canvas1></canvas><p>按照定义,两个物体没有碰撞,那么一定能够找到有间隙的投影.<p>下图黄色线就是这个间隙</p><canvas id=canvas2></canvas><h3>轴</h3><p>如上图,阴影所在的线称为"投影轴".如上上图,投影轴就是画布的下边界和右边界.<p>这条轴是怎么确定的呢?由图可见,这投影轴并不一定要在图中所示位置,是可以靠前或者靠后,只要与轴平行.其实,投影轴有无数条<p>由图可见,投影轴与投射光线垂直.所以,投影轴其实由投射光线决定.<h3>投射光线与投影轴</h3><p>那么,投射光线的方向怎么决定?应该说是,从哪个方向做投影.事实上,可以从360度的全部方位进行投影.<p>上图就是所有360度方位中的一个方位,此方位的投影找到了间隙,说明了那两个物体没有碰撞.<p>SAT定理可以这样看,对于上图的两个物体,拿电灯(点光源)照射,看阴影是否有间隙.将电灯围着两个物体转一圈(360度),如果阴影始终是<p>有重叠的,那说明碰撞了.如果在任何一个角度上,阴影有间隙,那就说明没有碰撞.<h3>凸多边形的边</h3><p>程序上不用检测360度全方位,只需要检测一些特定的角度就可以.<p>凸多边形的每一条边就是一个投射光线的方向.如上图,两个物体一共有7条边,那么只要检测这7个方向就能判断是否碰撞<p>而且,只要有一个方向发现阴影有间隙,就说明没有碰撞.剩下的方向就不用检测了<h3>检测凸多边形投影</h3><p>实现第一个方法,给定一个多边形,检测它的投影.按边的顺时针方向,求出凸多边形在所有边的投影轴上的投影.<p>此方法的关键点是要计算出投影轴的合适位置和投影点的位置.每一条投影轴上有n-1个顶点的投影(投影光线(边)所在的两点重合了)<p><p>下图按方向 ab - bc - cd - da ...分别画出投影轴和投影点,这两个凸多边形有9条边,所以有9条投影轴<p>在绘画时,使用坐标系变换.例如,ab边为投影光线,那么,将canvas坐标系平移到a点,再旋转ab线段的斜率对应的角度,<p>(即以ab线段所在的直线为X轴,a是原点,b是正方向上一点).这时,投影轴在变换后的坐标系中,是一条与Y轴平行的直线.<p>此时再计算出其它顶点在新坐标系的坐标值,这些点的Y值的最大值和最小值就是投影轴的Y值端点范围.而X值中的最大值加上<p>合适的距离(如20px)就是投影轴的X值.这样,投影轴就画出来了.投影轴上各顶点的投影点,它们的X值就是投影轴的X值,而Y值<p>就是这些点的Y值.<div class=grids><canvas id=canvas3></canvas><div><p><span class=label>蓝色多边形</span><div id=poly1btnbox></div><br><p><span class=label>橄榄色多边形</span><div id=poly2btnbox></div></div></div><h3>碰撞判断</h3><p>上图,投影点有重合的投影轴,是青绿色的.<p>实现上面的投影检测后,就已经可以判断碰撞了.判断投影点是否有空隙,只要判断两个凸多边形的投影点坐标是否有交集<p>举例说明,在一个投影轴上,多边形1的投影点的Y坐标(排序后)为[1,3,6,9],多边形2的Y坐标为[10,12,13],那么显然是没有交集的<p>所以不碰撞.如果是[1,2,5]和[4,8,9]那么是有交集的,多边形2的第一个点[4],在多边形1的第2个点和第3个点之间[2,5],此时要<p>判断下一个投影轴,按照SAT定义,如果所有投影轴都有交集,那么两个多边形是碰撞的<p>为什么只检查Y(或者X,投影轴水平时)坐标就能判断交集呢?因为点都在同一条线上(投影轴,投影点).可以当作数轴看待.<h3>圆与凸多边形</h3><p>两个圆形碰撞检测,只需要判断两个圆的圆心距离是否小于两个半径之和<p>下图r1,r2半径之和小于r1r2圆心的距离,所以不碰撞.r3,r4圆心距离小于半径之和,所以碰撞了<div class=grids><canvas id=canvas4></canvas><canvas id=canvas5></canvas></div><p>圆可以从0~360度方向投影,和多边形不同,圆的边可以是无数条,没法用边做投影光线方向.<p>选取半径为投影光线方向,从与X轴重合的半径开始,顺时针每120度,取一条半径做一个投影<p>圆的投影点总是两个,距离就是圆的直径.</p><canvas id=canvas6></canvas><p>在圆与多边形碰撞检测中,多边形的投影轴仍然由边来定.而圆的投影轴,则由圆心与多边形顶点的连线来定<p>而且只需要一条连线,就是最短的那一条.所以要确定投影轴,要计算出与圆心最近的顶点.<p>&lt;&lt;H5核心技术图形动画与游戏开发(David Geary)>> 355 圆与多边形<p>圆与多边形碰撞检测,一共有N+1条轴,N边形,N条,圆1条(下图绿色的线段)<div class=grids><canvas id=canvas7></canvas><div><p><span class=label>圆</span><div id=cir1btnbox></div><br><p><span class=label>多边形</span><div id=poly3btnbox></div></div></div><h3>程序测验</h3><p>实现方法1,传入两个多边形顶点坐标数组,返回是否碰撞<p>实现方法2,传入1个多边形顶点坐标数组和一个圆的圆心和半径,返回是否碰撞<p>satCheck.polyons()</p><canvas id=canvas8></canvas><p>satCheck.polyonCircle()</p><canvas id=canvas9></canvas><h3>算法思路</h3><h4>1.确定投影光线及其方向</h4><p>多边形的每条边就是投影光线,从一点起,顺时针走一圈,得到所有投影光线方向<p>如果是圆与多边形,圆的投影轴只需要一条,就是圆心与多边形最近的顶点的连线.投影光线则是与这投影轴垂直的线,从圆心点开始,到与圆的交点<h4>2.投影轴与投影点</h4><p>计算投影点坐标的方法,可以利用坐标系变换.先平移再旋转.以投影光线的起点为新原点做平移变换,再以投影光线的斜率对应角度做旋转变换<p>然后在这个新坐标系上,计算出所有点的新坐标.对于多边形,除了投影光线起点无需计算(为新坐标系0,0点),其它顶点需要计算.对于圆,有两个点 ,<p>与投影光线垂直的那条圆的直径,在圆周上的两个点.<p>投影轴在新坐标系中,实际上是N条与Y轴平行的线(也能是Y轴).因为投影轴与投影光线垂直,而坐标系变换办法,使得X轴与投影光线重合.<h4>3.投影点交集判断</h4><p>投影点在投影轴上的坐标,其X值都是一样的.而其Y值就是多边形或圆在新坐标系中的Y值.这时,投影点就像一条数轴,可以用判断集合是否有交集的<p>办法.集合的边界就是多边形或圆的投影点Y值的最大值和最小值.判断如果有交集,则说明多边形和多边形(或圆)可能碰撞,如果没有则说明没有碰撞.<p>根据SAT,程序只要检测到没有交集就可以退出.而判定为碰撞,程序要检测所有投影轴都存在投影点交集.</div><hr class=line><script src=/asset/js/article.js></script><script src=/jslib/cavlib.js></script><script>function canva10(){var n;let u=cavlib("canvas10").style(),t=u.ctx,i=[50,60,120,30,100,110,60,100];for(drawPolygon(t,i,"white"),n=0;n<i.length/2;n+=2)t.beginPath(),t.moveTo(i[n],i[n+1]),t.lineTo(i[n+4],i[n+5]),t.stroke();let r=[150,30,220,50,170,80,160,140];for(drawPolygon(t,r,"white"),n=0;n<r.length/2;n+=2)t.beginPath(),t.moveTo(r[n],r[n+1]),t.lineTo(r[n+4],r[n+5]),t.stroke()}function canva9(){let o=cavlib("canvas9").style(),t=o.ctx;t.font="18px serial";let i=[50,60,120,30,100,110,60,100],u=randInt(25,60),n={x:10,y:50,r:30,speed:25,bg:"green"},s=n=>{let i=[];for(var t=0;t<n.length;t+=2)i.push({x:n[t],y:n[t+1]});return i},r=(n,t,i="x")=>{var r;if(i=="x")for(r=0;r<n.length;r+=2)n[r]+=t;else for(r=0;r<n.length;r+=2)n[r+1]+=t},f=0,e=o=>{let l=o-f;f=o;t.clearRect(0,0,300,150);drawPolygon(t,i,"steelblue");t.beginPath();t.arc(n.x,n.y,n.r,0,Math.PI*2);t.fillStyle=n.bg;t.fill();t.fillStyle="black";t.fillText(Math.abs(u)+"px/s",i[0]+10,i[1]+20);t.fillText(Math.abs(n.speed)+"px/s",n.x-n.r,n.y);window.satCheck.polyonCircle(i,n)==!0&&(t.beginPath(),t.fillText("!~撞~!",0,20));let a=u*l/1e3;r(i,a,"x");n.x+=n.speed*l/1e3;let h=maxPoint(s(i)),c=randInt(10,25);c%2==0&&(c=-c);h.minx.x<0?(r(i,c,"y"),u=randInt(25,60)):h.maxx.x>300&&(r(i,c,"y"),u=-randInt(25,60));h.miny.y>150?r(i,-(h.maxy.y-150),"y"):h.maxy.y<50&&r(i,h.maxy.y-h.miny.y-50,"y");n.x<n.r?(n.x=n.r,n.y=randInt(50,100),n.speed=randInt(25,60)):n.x>300-n.r&&(n.x=300-n.r,n.y=randInt(50,100),n.speed=-randInt(25,60));window.requestAnimationFrame(e)};window.requestAnimationFrame(e)}function canva8(){let h=cavlib("canvas8").style(),r=h.ctx;r.font="18px serial";let n=[50,30,120,70,100,130,60,120],u=randInt(25,60),t=[160,30,220,50,230,90,180,110,125,115],f=-randInt(25,60),e=n=>{let i=[];for(var t=0;t<n.length;t+=2)i.push({x:n[t],y:n[t+1]});return i},i=(n,t,i="x")=>{var r;if(i=="x")for(r=0;r<n.length;r+=2)n[r]+=t;else for(r=0;r<n.length;r+=2)n[r+1]+=t},o=0,s=h=>{let y=h-o;o=h;r.clearRect(0,0,300,150);drawPolygon(r,n,"steelblue");drawPolygon(r,t,"olive");r.fillText(Math.abs(u)+"px/s",n[0],n[1]+40);r.fillText(Math.abs(f)+"px/s",t[0],t[1]+40);window.satCheck.polyons(n,t)==!0&&(r.beginPath(),r.fillText("!~撞~!",0,20),u=-u+(u>0?-randInt(1,10):+randInt(1,10)),f=-f+(f>0?-randInt(1,10):+randInt(1,10)));let p=u*y/1e3;i(n,p,"x");let w=f*y/1e3;i(t,w,"x");let c=maxPoint(e(n)),a=randInt(10,25);a%2==0&&(a=-a);c.minx.x<0?(i(n,a,"y"),u=randInt(25,60)):c.maxx.x>300&&(i(n,a,"y"),u=-randInt(25,60));c.miny.y>150?i(n,-(c.maxy.y-150),"y"):c.maxy.y<50&&i(n,c.maxy.y-c.miny.y-50,"y");let l=maxPoint(e(t)),v=randInt(10,25);v%2==0&&(v=-v);l.minx.x<0?(i(t,v,"y"),f=randInt(25,60)):l.maxx.x>300&&(i(t,v,"y"),f=-randInt(25,60));l.miny.y>150?i(t,-(l.maxy.y-150),"y"):l.maxy.y<50&&i(t,l.maxy.y-l.miny.y-50,"y");window.requestAnimationFrame(s)};window.requestAnimationFrame(s)}function canva7(n=1,t=null,i=true){var u,s,o;let h=cavlib("canvas7").style(),r=h.ctx;r.canvas.width=500;r.canvas.height=380;r.font="16px serial";let f={x:140,y:180,r:50,speed:25,bg:"gray"};r.arc(f.x,f.y,f.r,0,Math.PI*2);r.fillStyle=f.bg;r.fill();let e=[210,130,370,80,350,200,260,240];for(drawPolygon(r,e,"steelblue"),i==!0&&(createBtnForPolyCircle(e,"poly3btnbox"),createBtnForPolyCircle([{x:f.x,y:f.y}],"cir1btnbox")),r.beginPath(),r.fillStyle="brown",u=0,s=0;u<e.length;u+=2,s++)r.fillText(String.fromCharCode(65+s),e[u],e[u+1]);if(n==1){let t={x:e[0],y:e[1]},l=Math.pow(f.x-e[0],2)+Math.pow(f.y-e[1],2);for(u=2;u<e.length;u+=2){let n=Math.pow(f.x-e[u],2)+Math.pow(f.y-e[u+1],2);l>n&&(l=n,t.x=e[u],t.y=e[u+1])}r.beginPath();r.moveTo(f.x,f.y);r.lineTo(t.x,t.y);r.strokeStyle="green";r.stroke();let a=getK([f.x,f.y,t.x,t.y])[0],v=a==null?Math.PI/2:Math.atan(-1/a),n=[{x:f.r,y:0},{x:0,y:f.r},{x:0,y:-f.r}],i=[];for(u=0;u<e.length;u+=2){let n={x:e[u],y:e[u+1]};i.push(trsPoint(n.x,n.y,[{ox:f.x,oy:f.y},{angle:v}]))}let y=!1,p=maxPoint(i),w=maxPoint(n);p.miny.y>w.maxy.y||p.maxy.y<w.miny.y||(y=!0);let c=maxPoint(i.concat(n)),s=c.maxx.x+20,b=c.miny.y-20,k=c.maxy.y+20;for(r.save(),r.beginPath(),r.translate(f.x,f.y),r.rotate(v),r.beginPath(),r.fillStyle="brown",u=0;u<n.length;u++)r.fillText(String.fromCharCode(65+u),n[u].x,n[u].y);for(r.save(),r.beginPath(),r.setLineDash([5]),r.strokeStyle=r.fillStyle="orangered",h.lineArrow([0,0,s+10,0],10),r.restore(),r.beginPath(),r.moveTo(s,b),r.lineTo(s,k),r.strokeStyle=y==!0?"chartreuse":"gray",r.stroke(),r.fillStyle=f.bg,o=0;o<n.length;o++)r.beginPath(),r.arc(s,n[o].y,2,0,Math.PI*2),r.fill();for(r.fillStyle="blue",o=0;o<i.length;o++)r.beginPath(),r.arc(s,i[o].y,2,0,Math.PI*2),r.fill();r.restore()}let c=getK(e);for(u=0;u<c.length;u++)if(t==null||!(t.indexOf(u)<0)){let b=c[u],p=b==null?Math.PI/2:Math.atan(b),i={ox:e[2*u],oy:e[2*u+1]},v={x:e[2*u+2],y:e[2*u+3]};u==c.length-1&&(v={x:e[0],y:e[1]});let n=[{x:0,y:0}];for(n[1]=trsPoint(v.x,v.y,[i,{angle:p}]),s=0;s<e.length;s+=2){let t={x:e[s],y:e[s+1]};(t.x!=i.ox||t.y!=i.oy)&&(t.x!=v.x||t.y!=v.y)&&n.push(trsPoint(t.x,t.y,[i,{angle:p}]))}let l=[],a=trsPoint(f.x,f.y,[i,{angle:p}]);l.push({x:a.x+(a.x>0?f.r:-f.r),y:a.y});l.push({x:a.x,y:a.y+f.r});l.push({x:a.x,y:a.y-f.r});let w=maxPoint(n.concat(l)),y=n[1].x>0?w.maxx.x+20:w.minx.x-20,nt=w.miny.y-20,tt=w.maxy.y+20,k=!1,d=maxPoint(n),g=maxPoint(l);for(d.miny.y>g.maxy.y||d.maxy.y<g.miny.y||(k=!0),r.save(),r.translate(i.ox,i.oy),r.rotate(p),r.save(),r.beginPath(),r.setLineDash([5]),r.strokeStyle=r.fillStyle="orangered",h.lineArrow([0,0,y+(n[1].x>0?10:-10),0],10),r.restore(),r.beginPath(),r.moveTo(y,nt),r.lineTo(y,tt),r.strokeStyle=k==!0?"chartreuse":"gray",r.stroke(),r.fillStyle="blue",o=0;o<n.length;o++)r.beginPath(),r.arc(y,n[o].y,2,0,Math.PI*2),r.fill();for(r.fillStyle=f.bg,o=0;o<l.length;o++)r.beginPath(),r.arc(y,l[o].y,2,0,Math.PI*2),r.stroke(),r.fill();r.restore()}}function createBtnForPolyCircle(n,t){var i;let u=document.querySelector("#"+t),r=[];if(n.length==1)r.push({name:"circle",order:1});else for(i=0;i<n.length/2;i++){let t=String.fromCharCode(97+i)+String.fromCharCode(97+(i==n.length/2-1?0:i+1));r.push({name:t,order:i})}let f="";for(i=0;i<r.length;i++)f+=`<input class="input-check" type="checkbox" title=${r[i].order} id="${t}_${i}" />
      <label class="input-check-label" for="${t}_${i}"><b class="check"></b>${r[i].name}</label><br>`;u.innerHTML=f;u.querySelectorAll(".input-check").forEach(n=>{n.onclick=n=>{n.stopPropagation();let i=document.querySelector("#cir1btnbox"),r=document.querySelector("#poly3btnbox"),u=i.querySelector(".input-check:checked"),f=r.querySelectorAll(".input-check:checked"),e=u?1:0,t=[];f.forEach(n=>{t.push(parseInt(n.title))});canva7(e,t,!1)},n.checked=!0})}function canva6(){let r=cavlib("canvas6").style(),n=r.ctx,t={x:150,y:70,r:40,bg:"steelblue"};n.arc(t.x,t.y,t.r,0,Math.PI*2);n.fillStyle=t.bg;n.fill();n.beginPath();n.arc(t.x,t.y,2,0,Math.PI*2);n.fillStyle="red";n.fill();n.save();n.translate(t.x,t.y);for(var i=0;i<3;i++){n.save();let u=t.r+20;n.rotate(Math.PI*2*i/3);n.save();n.beginPath();n.setLineDash([5]);n.strokeStyle=n.fillStyle="orangered";r.lineArrow([0,0,u+10,0],10);n.restore();n.beginPath();n.moveTo(u,-t.r-15);n.lineTo(u,t.r+15);n.strokeStyle="gray";n.stroke();n.beginPath();n.arc(u,-t.r,2,0,Math.PI*2);n.arc(u,t.r,2,0,Math.PI*2);n.fillStyle="blue";n.fill();n.restore()}n.restore()}function canva5(){let e=cavlib("canvas5").style(),i=e.ctx;i.font="16px serial";i.textAlign="center";let n={x:20,y:70,r:28,speed:25,bg:"gray"},t={x:275,y:50,r:35,speed:-25,bg:"steelblue"},r=[n,t],u=0,f=e=>{let s=e-u;u=e;i.clearRect(0,0,300,150);for(var o=0;o<r.length;o++)i.beginPath(),i.arc(r[o].x,r[o].y,r[o].r,0,Math.PI*2),i.fillStyle=r[o].bg,i.fill(),i.beginPath(),i.fillStyle="darkblue",i.fillText(Math.abs(r[o].speed)+"px/s",r[o].x,r[o].y);if((n.y-t.y)*(n.y-t.y)+(n.x-t.x)*(n.x-t.x)<(n.r+t.r)*(n.r+t.r)){n.speed=-n.speed+(n.speed>0?-randInt(1,10):+randInt(1,10));t.speed=-t.speed+(t.speed>0?-randInt(1,10):+randInt(1,10));i.save();i.translate(n.x,n.y);i.rotate(Math.atan((n.y-t.y)/(n.x-t.x)));let r=n.r+t.r;i.moveTo(n.r,r);i.lineTo(n.r,-r);i.strokeStyle="red";i.stroke();i.beginPath();i.moveTo(0,0);i.lineTo(r,0);i.stroke();i.restore();setTimeout(()=>{n.x-=1,t.x+=1,u+=1e3,window.requestAnimationFrame(f)},1e3);return}n.x+=n.speed*s/1e3;t.x+=t.speed*s/1e3;n.x<n.r?(n.x=n.r,n.y=randInt(50,100),n.speed=randInt(25,60)):n.x>300-n.r&&(n.x=300-n.r,n.y=randInt(50,100),n.speed=-randInt(25,60));t.x<t.r?(t.x=t.r,t.y=randInt(50,100),t.speed=randInt(25,60)):t.x>300-t.r&&(t.x=300-t.r,t.y=randInt(50,100),t.speed=-randInt(25,60));window.requestAnimationFrame(f)};window.requestAnimationFrame(f)}function canva4(){var t;let o=cavlib("canvas4").style(),n=o.ctx;n.font="18px serial";let i={x:20,y:70,r:20,bg:"gray"},r={x:90,y:50,r:25,bg:"steelblue"},u={x:180,y:90,r:35,bg:"olive"},f={x:210,y:40,r:30,bg:"chartreuse"},e=[i,r,u,f];for(t=0;t<e.length;t++){let i=e[t];n.beginPath();n.arc(i.x,i.y,i.r,0,Math.PI*2);n.fillStyle=i.bg;n.fill();n.fillText(`r${t+1} = ${i.r}`,i.x-10,i.y+i.r+15);n.beginPath();n.arc(i.x,i.y,2,0,Math.PI*2);n.fillStyle="black";n.fill()}for(n.beginPath(),n.strokeStyle="red",t=0;t<e.length;t++)n.lineTo(e[t].x,e[t].y);n.stroke();let s=Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y)),h=Math.sqrt((u.x-f.x)*(u.x-f.x)+(u.y-f.y)*(u.y-f.y));n.fillText("r1r2 = "+parseFloat(s.toFixed(2)),10,20);n.fillText("r3r4 = "+parseFloat(h.toFixed(2)),140,20)}function createBtnForPolys(n,t){var i;let u=document.querySelector("#"+t),r=[];for(i=0;i<n.length/2;i++){let t=String.fromCharCode(97+i)+String.fromCharCode(97+(i==n.length/2-1?0:i+1));r.push({name:t,order:i})}let f="";for(i=0;i<r.length;i++)f+=`<input class="input-check" type="checkbox" title=${r[i].order} id="${t}_${i}" />
      <label class="input-check-label" for="${t}_${i}"><b class="check"></b>${r[i].name}</label><br>`;u.innerHTML=f;u.querySelectorAll(".input-check").forEach(n=>{n.onclick=n=>{n.stopPropagation();let r=document.querySelector("#poly1btnbox"),u=document.querySelector("#poly2btnbox"),f=r.querySelectorAll(".input-check:checked"),e=u.querySelectorAll(".input-check:checked"),t=[],i=[];f.forEach(n=>{t.push(parseInt(n.title))});e.forEach(n=>{i.push(parseInt(n.title))});canva3(t,i,!1)},n.checked=!0})}function canva3(n=null,t=null,i=true){var u,f,s;let h=cavlib("canvas3").style(),r=h.ctx;r.canvas.width=500;r.canvas.height=380;r.font="16px serial";let e=[110,130,210,100,210,170,90,220];drawPolygon(r,e,"steelblue");let o=[240,120,350,120,370,140,310,230,275,225];for(drawPolygon(r,o,"olive"),i==!0&&(createBtnForPolys(e,"poly1btnbox"),createBtnForPolys(o,"poly2btnbox")),r.fillStyle="brown",u=0,f=0;u<e.length;u+=2,f++)r.fillText(String.fromCharCode(65+f),e[u],e[u+1]);for(u=0,f=0;u<o.length;u+=2,f++)r.fillText(String.fromCharCode(65+f),o[u],o[u+1]);let c=getK(e),l=getK(o);for(u=0;u<c.length;u++)if(n==null||!(n.indexOf(u)<0)){let w=c[u],y=w==null?Math.PI/2:Math.atan(w),i={ox:e[2*u],oy:e[2*u+1]},l={x:e[2*u+2],y:e[2*u+3]};u==c.length-1&&(l={x:e[0],y:e[1]});let t=[{x:0,y:0}];for(t[1]=trsPoint(l.x,l.y,[i,{angle:y}]),f=0;f<e.length;f+=2){let n={x:e[f],y:e[f+1]};(n.x!=i.ox||n.y!=i.oy)&&(n.x!=l.x||n.y!=l.y)&&t.push(trsPoint(n.x,n.y,[i,{angle:y}]))}let a=[];for(f=0;f<o.length;f+=2){let n={x:o[f],y:o[f+1]};a.push(trsPoint(n.x,n.y,[i,{angle:y}]))}let p=maxPoint(t.concat(a)),v=t[1].x>0?p.maxx.x+20:p.minx.x-20,g=p.miny.y-20,nt=p.maxy.y+20,b=!1,k=maxPoint(t),d=maxPoint(a);for(k.miny.y>d.maxy.y||k.maxy.y<d.miny.y||(b=!0),r.save(),r.translate(i.ox,i.oy),r.rotate(y),r.save(),r.beginPath(),r.setLineDash([5]),r.strokeStyle=r.fillStyle="orangered",h.lineArrow([0,0,v+(t[1].x>0?10:-10),0],10),r.restore(),r.beginPath(),r.moveTo(v,g),r.lineTo(v,nt),r.strokeStyle=b==!0?"chartreuse":"gray",r.stroke(),r.fillStyle="blue",s=0;s<t.length;s++)r.beginPath(),r.arc(v,t[s].y,2,0,Math.PI*2),r.fill();for(r.fillStyle="olive",s=0;s<a.length;s++)r.beginPath(),r.arc(v,a[s].y,2,0,Math.PI*2),r.fill();r.restore()}for(u=0;u<l.length;u++)if(t==null||!(t.indexOf(u)<0)){let d=l[u],y=Math.atan(d),i={ox:o[2*u],oy:o[2*u+1]},c={x:o[2*u+2],y:o[2*u+3]};u==l.length-1&&(c={x:o[0],y:o[1]});let n=[{x:0,y:0}];for(n[1]=trsPoint(c.x,c.y,[i,{angle:y}]),f=0;f<o.length;f+=2){let t={x:o[f],y:o[f+1]};(t.x!=i.ox||t.y!=i.oy)&&(t.x!=c.x||t.y!=c.y)&&n.push(trsPoint(t.x,t.y,[i,{angle:y}]))}let a=[];for(f=0;f<e.length;f+=2){let n={x:e[f],y:e[f+1]};a.push(trsPoint(n.x,n.y,[i,{angle:y}]))}let p=maxPoint(n.concat(a)),v=n[1].x>0?p.maxx.x+20:p.minx.x-20,g=p.miny.y-20,nt=p.maxy.y+20,w=!1,b=maxPoint(n),k=maxPoint(a);for(b.miny.y>k.maxy.y||b.maxy.y<k.miny.y||(w=!0),r.save(),r.translate(i.ox,i.oy),r.rotate(y),r.save(),r.beginPath(),r.setLineDash([5]),r.strokeStyle=r.fillStyle="orangered",h.lineArrow([0,0,v+(n[1].x>0?10:-10),0],10),r.restore(),r.beginPath(),r.moveTo(v,g),r.lineTo(v,nt),r.strokeStyle=w==!0?"chartreuse":"gray",r.stroke(),r.fillStyle="olive",s=0;s<n.length;s++)r.beginPath(),r.arc(v,n[s].y,2,0,Math.PI*2),r.fill();for(r.fillStyle="blue",s=0;s<a.length;s++)r.beginPath(),r.arc(v,a[s].y,2,0,Math.PI*2),r.fill();r.restore()}}function trsPoint(n,t,i){let r={x:n,y:t};for(var u=0;u<i.length;u++){let n=i[u];n.hasOwnProperty("ox")?r=translatePoint(r.x,r.y,n.ox,n.oy):n.hasOwnProperty("angle")?r=rotatePoint(r.x,r.y,n.angle):n.hasOwnProperty("zx")&&(r=scalePoint(r.x,r.y,n.zx,n.zy))}return r}function translatePoint(n,t,i,r){let u=n-i,f=t-r;return{x:u,y:f}}function rotatePoint(n,t,i){let r=n*Math.cos(i)+t*Math.sin(i),u=t*Math.cos(i)-n*Math.sin(i);return{x:parseFloat(r.toFixed(4)),y:parseFloat(u.toFixed(4))}}function scalePoint(n,t,i,r){let u=n/i,f=t/r;return{x:u,y:f}}function canva2(){let tt=cavlib("canvas2").style(),n=tt.ctx;n.canvas.width=400;n.canvas.height=200;n.font="16px serial";let t=[100,40,120,120,160,50];drawPolygon(n,t,"blue");let e=[190,90,140,100,190,30,225,40];drawPolygon(n,e,"red");let u=(t[5]-t[3])/(t[4]-t[2]),f=t.concat(e);for(var i=0;i<f.length;i+=2){let t=f[i],r=f[i+1],e=0,o=r+u*(e-t);shadowGuide(n,[t,r,e,o],"gray",1)}let r=-1/u,o=0,s=110,h=200,it=s+r*(h-o);shadowLine(n,o,s,h,it,"black",1);let c=0,l=90,a=200,rt=l+r*(a-c);shadowLine(n,c,l,a,rt,"green",1);let v=45,y=135,p=95,ut=y+r*(p-v);shadowLine(n,v,y,p,ut,"blue",4);let w=102,b=166,k=140,ft=b+r*(k-w);shadowLine(n,w,b,k,ft,"red",4);let d=193,g=0,nt=70,et=g+u*(nt-d);shadowLine(n,d,g,nt,et,"gold",4)}function canva1(){let f=cavlib("canvas1").style(),n=f.ctx,r=400,u=200;n.canvas.width=r;n.canvas.height=u;n.font="16px serial";let e=[100,40,120,120,160,50];drawPolygon(n,e,"blue");let o=[190,90,140,100,190,30,225,40];drawPolygon(n,o,"red");let t=maxXY(e),i=maxXY(o);n.save();n.setLineDash([5]);f.lineArrow([0,60,60,60],8);n.fillText("光线",2,80);f.lineArrow([180,0,180,15],8);n.fillText("光线",185,20);n.restore();shadowLine(n,r-4,t.miny,r-4,t.maxy,"blue",4);shadowLine(n,r-4,i.miny,r-4,i.maxy,"red",4);shadowGuide(n,[0,t.miny,r,t.miny],"blue",1);shadowGuide(n,[0,t.maxy,r,t.maxy],"blue",1);shadowGuide(n,[0,i.miny,r,i.miny],"red",1);shadowGuide(n,[0,i.maxy,r,i.maxy],"red",1);shadowLine(n,t.minx,u-4,t.maxx,u-4,"blue",4);shadowLine(n,i.minx,u-4,i.maxx,u-4,"red",4);shadowGuide(n,[t.minx,0,t.minx,u],"blue",1);shadowGuide(n,[t.maxx,0,t.maxx,u],"blue",1);shadowGuide(n,[i.minx,0,i.minx,u],"red",1);shadowGuide(n,[i.maxx,0,i.maxx,u],"red",1)}function shadowLine(n,t,i,r,u,f,e){n.save();n.beginPath();n.globalAlpha=.5;f&&(n.strokeStyle=f);e&&(n.lineWidth=e);n.moveTo(t,i);n.lineTo(r,u);n.stroke();n.restore()}function shadowGuide(n,t,i,r){n.save();i&&(n.strokeStyle=i);r&&(n.lineWidth=r);n.beginPath();n.setLineDash([5]);n.moveTo(t[0],t[1]);for(var u=2;u<t.length;u+=2)n.lineTo(t[u],t[u+1]);n.stroke();n.restore()}function maxXY(n){let t=n[0],i=n[1],u=t,f=i;for(var r=2;r<n.length;r+=2){let e=n[r];t=Math.max(t,e);u=Math.min(u,e);let o=n[r+1];i=Math.max(i,o);f=Math.min(f,o)}return{maxx:t,maxy:i,minx:u,miny:f}}function maxPoint(n){let i={x:n[0].x,y:n[0].y};maxY={x:n[0].x,y:n[0].y};let r={x:n[0].x,y:n[0].y},u={x:n[0].x,y:n[0].y};for(var t=1;t<n.length;t++)i.x<n[t].x&&(i.x=n[t].x,i.y=n[t].y),r.x>n[t].x&&(r.x=n[t].x,r.y=n[t].y),maxY.y<n[t].y&&(maxY.x=n[t].x,maxY.y=n[t].y),u.y>n[t].y&&(u.x=n[t].x,u.y=n[t].y);return{maxx:i,maxy:maxY,minx:r,miny:u}}function drawPolygon(n,t,i){n.save();i&&(n.fillStyle=i);n.beginPath();n.moveTo(t[0],t[1]);for(var r=2;r<t.length;r+=2)n.lineTo(t[r],t[r+1]);n.closePath();n.fill();n.restore()}function getK(n){let i=n.concat(n[0],n[1]),r=[];for(var t=0;t<i.length-2;t+=2){let n=i[t+3]-i[t+1],u=i[t+2]-i[t];if(n==0){r.push(0);continue}if(u==0){r.push(null);continue}r.push(n/u)}return r}function randInt(n,t){let i=Math.random()*(t-n);return Math.floor(i)+n}(n=>{let i=n=>{let i=n.concat(n[0],n[1]),r=[];for(var t=0;t<i.length-2;t+=2){let n=i[t+3]-i[t+1],u=i[t+2]-i[t];if(n==0){r.push(0);continue}if(u==0){r.push(null);continue}r.push(n/u)}return r},o=(n,t,i,r)=>{let u=n-i,f=t-r;return{x:u,y:f}},s=(n,t,i)=>{let r=n*Math.cos(i)+t*Math.sin(i),u=t*Math.cos(i)-n*Math.sin(i);return{x:parseFloat(r.toFixed(4)),y:parseFloat(u.toFixed(4))}},h=(n,t,i,r)=>{let u=n/i,f=t/r;return{x:u,y:f}},r=(n,t,i)=>{let r={x:n,y:t};for(var u=0;u<i.length;u++){let n=i[u];n.hasOwnProperty("ox")?r=o(r.x,r.y,n.ox,n.oy):n.hasOwnProperty("angle")?r=s(r.x,r.y,n.angle):n.hasOwnProperty("zx")&&(r=h(r.x,r.y,n.zx,n.zy))}return r},t=n=>{let i={x:n[0].x,y:n[0].y};maxY={x:n[0].x,y:n[0].y};let r={x:n[0].x,y:n[0].y},u={x:n[0].x,y:n[0].y};for(var t=1;t<n.length;t++)i.x<n[t].x&&(i.x=n[t].x,i.y=n[t].y),r.x>n[t].x&&(r.x=n[t].x,r.y=n[t].y),maxY.y<n[t].y&&(maxY.x=n[t].x,maxY.y=n[t].y),u.y>n[t].y&&(u.x=n[t].x,u.y=n[t].y);return{maxx:i,maxy:maxY,minx:r,miny:u}},u=(n,t,i,u)=>{let o=[{x:0,y:0}],f={x:n[2*u+2],y:n[2*u+3]};u==o.length/2-1&&(f={x:n[0],y:n[1]});f=r(f.x,f.y,[t,{angle:i}]);for(var e=0;e<n.length;e+=2){let u={x:n[e],y:n[e+1]};(u.x!=t.x||u.y!=t.y)&&(u.x!=f.x||u.y!=f.y)&&o.push(r(u.x,u.y,[t,{angle:i}]))}return o},e=(n,t,i)=>{let f=[];for(var u=0;u<n.length;u+=2){let e={x:n[u],y:n[u+1]};f.push(r(e.x,e.y,[t,{angle:i}]))}return f},c=n=>[{x:n.r,y:0},{x:0,y:n.r},{x:0,y:-n.r}],l=(n,t,i)=>{let f=[],u=r(n.x,n.y,[t,{angle:i}]);return f.push({x:u.x+(u.x>0?n.r:-n.r),y:u.y}),f.push({x:u.x,y:u.y+n.r}),f.push({x:u.x,y:u.y-n.r}),f},a=(n,t)=>{let u={x:t[0],y:t[1]},f=Math.pow(n.x-t[0],2)+Math.pow(n.y-t[1],2);for(var r=2;r<t.length;r+=2){let i=Math.pow(n.x-t[r],2)+Math.pow(n.y-t[r+1],2);f>i&&(f=i,u.x=t[r],u.y=t[r+1])}let e=i([n.x,n.y,u.x,u.y])[0];return e==null?Math.PI/2:Math.atan(-1/e)},f={};f.polyons=(n,r)=>{var f;if(!n||n.length<3||!r||r.length<3)return!1;let o=i(n),s=i(r);for(f=0;f<o.length;f++){let i={ox:n[2*f],oy:n[2*f+1]},s=o[f]==null?Math.PI/2:Math.atan(o[f]),l=u(n,i,s,f),a=e(r,i,s),h=t(l),c=t(a);if(h.miny.y>c.maxy.y||h.maxy.y<c.miny.y)return!1}for(f=0;f<s.length;f++){let i={ox:r[2*f],oy:r[2*f+1]},o=s[f]==null?Math.PI/2:Math.atan(s[f]),l=u(r,i,o,f),a=e(n,i,o),h=t(l),c=t(a);if(h.miny.y>c.maxy.y||h.maxy.y<c.miny.y)return!1}return!0};f.polyonCircle=(n,r)=>{if(!n||n.length<3||!r)return!1;let e=i(n);for(var f=0;f<e.length;f++){let i={ox:n[2*f],oy:n[2*f+1]},o=e[f]==null?Math.PI/2:Math.atan(e[f]),c=u(n,i,o,f),a=l(r,i,o),s=t(c),h=t(a);if(s.miny.y>h.maxy.y||s.maxy.y<h.miny.y)return!1}let h=a(r,n),v=c(r),y=u(n,{ox:r.x,oy:r.y},h),o=t(v),s=t(y);return o.miny.y>s.maxy.y||o.maxy.y<s.miny.y?!1:!0};n.satCheck=f})(window);canva1();canva2();canva3();canva4();canva5();canva6();canva7();canva8();canva9();canva10()</script></div></div><script src=/asset/js/mainmenu.js></script>